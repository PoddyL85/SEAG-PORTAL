<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nicolas's SEAG Portal</title>
    
    <!-- Google Fonts: Orbitron for a gaming feel -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">

    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel to compile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            font-family: 'Roboto', sans-serif;
        }
        .font-orbitron {
            font-family: 'Orbitron', sans-serif;
        }
        .glowing-border {
            box-shadow: 0 0 2px #00aaff, 0 0 5px #00aaff, 0 0 10px #00aaff;
        }
        .glowing-text {
            text-shadow: 0 0 5px #00aaff, 0 0 10px #00aaff;
        }
    </style>
</head>
<body class="bg-slate-900 text-gray-200">
    <div id="root"></div>

    <script type="text/babel">
        // This is your entire React Application inside a single script tag.
        // All Firebase code has been removed. Data is now saved in the browser.

        const { useState, useEffect, useCallback } = React;

        // --- Default Test Data ---
        // This is the initial set of tests. New tests created in the Admin Panel
        // will be saved to the browser's localStorage.
        const defaultTests = [
            {
                id: "maths-pack-1",
                title: "Maths Test Pack 1",
                subject: "Maths",
                questions: [
                  { question: "A football pitch measures 115 metres long and 80 metres wide. The area of a rugby pitch is 6,392 square metres. How many square metres smaller is the area of the rugby pitch than the area of the football pitch?", options: ["9200 m²", "2908 m²", "2809 m²", "2808 m²", "6197 m²"], answer: "2808 m²" },
                  { question: "Convert this measurement: 1701 g = ___ kg", options: ["17.01 kg", "1.701 kg", "170.1 kg", "1.7 kg", "0.1701 kg"], answer: "1.701 kg" },
                  { question: "How many lines of symmetry does a rhombus have?", options: ["0", "1", "2", "3", "4"], answer: "2" },
                  { question: "Which is the most appropriate instrument for measuring the distance around a football?", options: ["trundle wheel", "odometer", "metre stick", "tape measure", "ruler"], answer: "tape measure" },
                  { question: "Ahmed cycled 13 km on Monday and 15 km on Thursday. How much further did he cycle on Thursday than on Monday?", options: ["1 km", "3 km", "5 km", "4 km", "2 km"], answer: "2 km" },
                  { question: "What decimal fraction is equivalent to 3/4?", options: ["0.25", "0.33", "0.20", "0.75", "0.10"], answer: "0.75" },
                  { question: "A regular hexagon has a side length of 7 cm. A square has the same perimeter as the hexagon. What is the area of the square?", options: ["42 cm²", "100 cm²", "10.5 cm²", "110.25 cm²", "49 cm²"], answer: "110.25 cm²" },
                  { question: "What is the tenth number in this sequence: 1.5, 3.0, 4.5, 6.0, ...?", options: ["9.0", "12.5", "15", "15.0", "17.5"], answer: "15.0" },
                  { question: "Girls in Years 4, 5, 6, and 7 collected £4, £12, £16, and £17 respectively. What was the average amount collected?", options: ["£12.00", "£12.25", "£12.50", "£10.00", "£13.00"], answer: "£12.25" },
                  { question: "A rectangle's corners are at A(25, 30), B(55, 30), C(55, 14), and D. What are the coordinates of point D?", options: ["(25, 14)", "(55, 30)", "(25, 22)", "(55, 14)", "(40, 14)"], answer: "(25, 14)" },
                  { question: "By how much is 18.401 greater than 14.1?", options: ["4.3", "3.3", "4.301", "3.301", "4"], answer: "4.301" },
                  { question: "A stack of 20 identical pizza boxes is 160 cm tall. Giovanni removes 3 from the top. How tall is the stack now?", options: ["130 cm", "132 cm", "134 cm", "136 cm", "138 cm"], answer: "136 cm" },
                  { question: "What would be the best unit of measure for recording the amount of water in a paddling pool?", options: ["litres", "mm", "cm", "m³", "ml"], answer: "litres" },
                  { question: "A scale shows a weight between 1.2 kg and 1.3 kg, marked in 10 increments. The pointer is on the 4th mark after 1.2. What is the weight?", options: ["1.21 kg", "1.22 kg", "1.23 kg", "1.24 kg", "1.25 kg"], answer: "1.24 kg" },
                  { question: "b × 6 = 48. What does (b + 2) × 5 equal?", options: ["30", "40", "20", "50", "60"], answer: "50" },
                  { question: "How many vertical lines are in an isosceles trapezium with a vertical line of symmetry drawn through it?", options: ["0", "1", "2", "3", "4"], answer: "1" },
                  { question: "What is 7/10 of £17?", options: ["£9.90", "£10.90", "£11.70", "£11.90", "£12.90"], answer: "£11.90" },
                  { question: "A chart showing population change over time with points connected by lines is what type of chart?", options: ["Block Graph", "Pie Chart", "Bar Graph", "Bar-Line Graph", "Line Graph"], answer: "Line Graph" },
                  { question: "A rectangle is divided into 8 equal squares. 6 of them are shaded. What fraction is shaded?", options: ["1/4", "3/8", "5/8", "3/4", "7/8"], answer: "3/4" },
                  { question: "A chart shows temperature ranges. The lowest is -13°C and the highest is 6°C. What is the difference between the highest and lowest temperatures?", options: ["-13°C", "18°C", "19°C", "20°C", "21°C"], answer: "19°C" },
                  { question: "Pattern 1 has 9 blocks. Pattern 2 has 13 blocks. Pattern 3 has 17 blocks. The rule is (Number of blocks) = 4 * PatternNumber + 5. Which pattern will have 49 blocks?", options: ["9", "10", "11", "12", "13"], answer: "11" },
                  { question: "In a sale, everything was reduced by 25%. How much would be saved on an item which usually cost £4.80?", answer: "£1.20" },
                  { question: "A decision tree sorts numbers. If the number is even, it checks if it's a multiple of 5. If not even, it checks if it's a square number. Which box would the number 64 be put into? (Box A: even, mult of 5. Box B: even, not mult of 5. Box C: odd, square. Box D: odd, not square)", answer: "B" },
                  { question: "What is the missing number in this sequence: 2, 5, 11, 23, ___?", answer: "47" },
                  { question: "A film starts at 19:45 and lasts for 1 hour and 35 minutes. What time does it finish?", answer: "21:20" },
                  { question: "Calculate 3.5 × 8.", answer: "28" },
                  { question: "A bag contains 6 red balls and 10 blue balls. What is the probability of picking a red ball?", answer: "6/16" },
                  { question: "What is 15% of 300?", answer: "45" }
                ]
            },
            {
                id: "maths-pack-2",
                title: "Maths Test Pack 2",
                subject: "Maths",
                questions: [
                    { question: "A baker uses 250g of flour for every cake. How many cakes can he bake with a 5kg bag of flour?", options: ["10", "15", "20", "25", "30"], answer: "20" },
                    { question: "What is the value of x if 4x + 5 = 25?", options: ["3", "4", "5", "6", "7"], answer: "5" },
                    { question: "A train travels at 60 mph. How long does it take to travel 150 miles?", options: ["2 hours", "2.5 hours", "3 hours", "3.5 hours", "4 hours"], answer: "2.5 hours" },
                    { question: "What is the next prime number after 19?", options: ["20", "21", "22", "23", "24"], answer: "23" },
                    { question: "A rectangle has a perimeter of 30 cm. Its length is 10 cm. What is its width?", options: ["5 cm", "6 cm", "7 cm", "8 cm", "10 cm"], answer: "5 cm" },
                    { question: "Simplify the ratio 18:24.", options: ["2:3", "3:4", "4:5", "5:6", "6:7"], answer: "3:4" },
                    { question: "What is 0.25 as a percentage?", options: ["2.5%", "25%", "250%", "0.025%", "0.25%"], answer: "25%" },
                    { question: "A circle has a radius of 5 cm. What is its diameter?", options: ["5 cm", "10 cm", "15 cm", "20 cm", "25 cm"], answer: "10 cm" },
                    { question: "Find the mean of these numbers: 4, 6, 8, 10.", options: ["5", "6", "7", "8", "9"], answer: "7" },
                    { question: "If a = 3 and b = 4, what is the value of 2a + 3b?", options: ["15", "16", "17", "18", "19"], answer: "18" },
                    { question: "How many degrees are in a right angle?", options: ["45", "90", "180", "270", "360"], answer: "90" },
                    { question: "What is the square root of 144?", options: ["10", "11", "12", "13", "14"], answer: "12" },
                    { question: "A map has a scale of 1:10000. A distance on the map is 5 cm. What is the real distance in metres?", options: ["50m", "500m", "5000m", "50000m", "5m"], answer: "500m" },
                    { question: "What is the area of a triangle with a base of 10 cm and a height of 6 cm?", options: ["20 cm²", "30 cm²", "40 cm²", "50 cm²", "60 cm²"], answer: "30 cm²" },
                    { question: "Convert 2.5 hours into minutes.", options: ["120", "130", "140", "150", "160"], answer: "150" },
                    { question: "What is the mode of this set of numbers: 2, 3, 3, 4, 5, 5, 5, 6?", options: ["2", "3", "4", "5", "6"], answer: "5" },
                    { question: "A cube has a volume of 27 cm³. What is the length of one side?", options: ["2 cm", "3 cm", "4 cm", "5 cm", "6 cm"], answer: "3 cm" },
                    { question: "What is 3/5 as a decimal?", options: ["0.3", "0.4", "0.5", "0.6", "0.7"], answer: "0.6" },
                    { question: "A car journey starts at 08:30 and ends at 11:15. How long was the journey?", options: ["2h 15m", "2h 30m", "2h 45m", "3h 00m", "3h 15m"], answer: "2h 45m" },
                    { question: "Increase £50 by 20%.", options: ["£52", "£55", "£58", "£60", "£62"], answer: "£60" },
                    { question: "What is the sum of the angles in a quadrilateral?", options: ["90°", "180°", "270°", "360°", "540°"], answer: "360°" },
                    { question: "Write 0.05 as a fraction in its simplest form.", answer: "1/20" },
                    { question: "A book costs £8.50. There is a 10% discount. What is the new price?", answer: "£7.65" },
                    { question: "How many faces does a triangular prism have?", answer: "5" },
                    { question: "What is the next number in the Fibonacci sequence: 1, 1, 2, 3, 5, 8, ___?", answer: "13" },
                    { question: "Calculate 1/4 + 3/8.", answer: "5/8" },
                    { question: "A square has an area of 64 cm². What is its perimeter?", answer: "32 cm" },
                    { question: "What is the largest factor of 24 (other than 24)?", answer: "12" }
                ]
            },
            {
                id: "english-pack-1",
                title: "English Test Pack 1",
                subject: "English",
                questions: [
                    { question: "Identify the sentence with the correct punctuation: The cat sat on the mat. or The cat, sat on the mat.", answer: "The cat sat on the mat." },
                    { question: "Which word is the adjective in this sentence: The quick brown fox jumps over the lazy dog.", answer: "quick" },
                    { question: "Choose the correct spelling: a) accomodate b) accommodate c) acommodate", answer: "b" },
                    { question: "What is the synonym for 'happy'?", options: ["Sad", "Joyful", "Angry", "Tired"], answer: "Joyful" },
                    { question: "Identify the verb in the sentence: She sings beautifully.", answer: "sings" },
                    { question: "Which of the following is a correctly punctuated question? a) Where are you going. b) Where are you going! c) Where are you going?", answer: "c" },
                    { question: "What is the plural of 'child'?", answer: "children" },
                    { question: "Choose the antonym for 'brave'.", options: ["Cowardly", "Heroic", "Strong", "Bold"], answer: "Cowardly" },
                    { question: "Identify the pronoun in: 'He gave the book to her.'", answer: "He" },
                    { question: "Correct the spelling of 'recieve'.", answer: "receive" },
                    { question: "Which sentence uses 'its' and 'it's' correctly?", options: ["The dog wagged it's tail because its happy.", "The dog wagged its tail because it's happy.", "The dog wagged it's tail because it's happy."], answer: "The dog wagged its tail because it's happy." },
                    { question: "What type of word is 'quickly'?", answer: "adverb" },
                    { question: "Find the error: 'Me and my friend went to the park.'", answer: "Me" },
                    { question: "What is the past tense of 'go'?", answer: "went" },
                    { question: "Identify the proper noun: 'We visited Paris in France.'", answer: "Paris" },
                    { question: "Which is the correct contraction for 'do not'?", answer: "don't" },
                    { question: "What does the prefix 'un-' mean in 'unhappy'?", answer: "not" },
                    { question: "Choose the correctly spelled word: a) seperate b) separate c) seporate", answer: "b" },
                    { question: "Identify the conjunction: 'I wanted to go, but I was too tired.'", answer: "but" },
                    { question: "What is the superlative form of 'good'?", answer: "best" },
                    { question: "Which sentence is in the passive voice?", options: ["The boy threw the ball.", "The ball was thrown by the boy."], answer: "The ball was thrown by the boy." },
                    { question: "What is the meaning of the idiom 'bite the bullet'?", answer: "To endure a difficult situation" },
                    { question: "Correct the sentence: 'their going to the store.'", answer: "They're going to the store." },
                    { question: "Identify the preposition: 'The cat is under the table.'", answer: "under" },
                    { question: "What is the collective noun for a group of lions?", answer: "pride" },
                    { question: "Choose the correct homophone: 'I want to go ___, over there.'", options: ["their", "there", "they're"], answer: "there" },
                    { question: "What is the function of an apostrophe in 'the cat's toy'?", answer: "To show possession" },
                    { question: "Which word completes the simile: 'as brave as a ___'?", answer: "lion" }
                ]
            },
            {
                id: "english-pack-2",
                title: "English Test Pack 2",
                subject: "English",
                questions: [
                    { question: "Which sentence is grammatically correct?", options: ["She done her homework.", "She did her homework."], answer: "She did her homework." },
                    { question: "What is the plural of 'goose'?", answer: "geese" },
                    { question: "Identify the adverb: 'The turtle walked slowly.'", answer: "slowly" },
                    { question: "Choose the correct word: 'The book is on ___ shelf.'", options: ["it's", "its"], answer: "its" },
                    { question: "What is an antonym for 'ancient'?", options: ["Old", "Modern", "Historic", "Past"], answer: "Modern" },
                    { question: "Which word is a noun?", options: ["beautiful", "ran", "happiness", "quickly"], answer: "happiness" },
                    { question: "Correct the spelling of 'neccessary'.", answer: "necessary" },
                    { question: "What does the suffix '-less' mean in 'careless'?", answer: "without" },
                    { question: "Identify the verb in the imperative sentence: 'Close the door.'", answer: "Close" },
                    { question: "What is the comparative form of 'bad'?", answer: "worse" },
                    { question: "Which of these is a compound sentence?", options: ["I like tea.", "I like tea and he likes coffee."], answer: "I like tea and he likes coffee." },
                    { question: "What is the collective noun for a group of fish?", answer: "school" },
                    { question: "Choose the correct homophone: 'She has a new ___ of shoes.'", options: ["pair", "pare", "pear"], answer: "pair" },
                    { question: "Identify the type of sentence: 'What a beautiful day!'", answer: "Exclamatory" },
                    { question: "What is the meaning of the idiom 'spill the beans'?", answer: "To reveal a secret" },
                    { question: "Correct the punctuation: 'Lets eat Grandma'", answer: "Let's eat, Grandma." },
                    { question: "What is the abstract noun in: 'Honesty is the best policy.'?", answer: "Honesty" },
                    { question: "Which word is spelled correctly?", options: ["wierd", "weird", "weerd"], answer: "weird" },
                    { question: "Identify the direct object: 'The dog chased the cat.'", answer: "cat" },
                    { question: "What is the opposite of 'expand'?", answer: "contract" },
                    { question: "Which sentence uses 'who' and 'whom' correctly?", options: ["Who did you give the book to?", "Whom did you give the book to?"], answer: "Whom did you give the book to?" },
                    { question: "What is the root word of 'unbelievable'?", answer: "believe" },
                    { question: "Identify the simile: 'He is as strong as an ox.'", answer: "as strong as an ox" },
                    { question: "What is the plural of 'cactus'?", answer: "cacti" },
                    { question: "Choose the correct verb form: 'The news ___ always on at 6.'", options: ["is", "are"], answer: "is" },
                    { question: "What type of pronoun is 'myself'?", answer: "Reflexive" },
                    { question: "Correct the sentence: 'I could of gone to the party.'", answer: "I could have gone to the party." },
                    { question: "What does the prefix 're-' mean in 'rewrite'?", answer: "again" }
                ]
            },
            {
                id: "full-test-1",
                title: "Full Practice Test 1",
                subject: "Mixed",
                questions: [
                    // English Section (28 Qs)
                    { question: "Identify the sentence with the correct punctuation: The cat sat on the mat. or The cat, sat on the mat.", answer: "The cat sat on the mat." },
                    { question: "Which word is the adjective in this sentence: The quick brown fox jumps over the lazy dog.", answer: "quick" },
                    { question: "Choose the correct spelling: a) accomodate b) accommodate c) acommodate", answer: "b" },
                    { question: "What is the synonym for 'happy'?", options: ["Sad", "Joyful", "Angry", "Tired"], answer: "Joyful" },
                    { question: "Identify the verb in the sentence: She sings beautifully.", answer: "sings" },
                    { question: "Which of the following is a correctly punctuated question? a) Where are you going. b) Where are you going! c) Where are you going?", answer: "c" },
                    { question: "What is the plural of 'child'?", answer: "children" },
                    { question: "Choose the antonym for 'brave'.", options: ["Cowardly", "Heroic", "Strong", "Bold"], answer: "Cowardly" },
                    { question: "Identify the pronoun in: 'He gave the book to her.'", answer: "He" },
                    { question: "Correct the spelling of 'recieve'.", answer: "receive" },
                    { question: "Which sentence uses 'its' and 'it's' correctly?", options: ["The dog wagged it's tail because its happy.", "The dog wagged its tail because it's happy.", "The dog wagged it's tail because it's happy."], answer: "The dog wagged its tail because it's happy." },
                    { question: "What type of word is 'quickly'?", answer: "adverb" },
                    { question: "Find the error: 'Me and my friend went to the park.'", answer: "Me" },
                    { question: "What is the past tense of 'go'?", answer: "went" },
                    { question: "Identify the proper noun: 'We visited Paris in France.'", answer: "Paris" },
                    { question: "Which is the correct contraction for 'do not'?", answer: "don't" },
                    { question: "What does the prefix 'un-' mean in 'unhappy'?", answer: "not" },
                    { question: "Choose the correctly spelled word: a) seperate b) separate c) seporate", answer: "b" },
                    { question: "Identify the conjunction: 'I wanted to go, but I was too tired.'", answer: "but" },
                    { question: "What is the superlative form of 'good'?", answer: "best" },
                    { question: "Which sentence is in the passive voice?", options: ["The boy threw the ball.", "The ball was thrown by the boy."], answer: "The ball was thrown by the boy." },
                    { question: "What is the meaning of the idiom 'bite the bullet'?", answer: "To endure a difficult situation" },
                    { question: "Correct the sentence: 'their going to the store.'", answer: "They're going to the store." },
                    { question: "Identify the preposition: 'The cat is under the table.'", answer: "under" },
                    { question: "What is the collective noun for a group of lions?", answer: "pride" },
                    { question: "Choose the correct homophone: 'I want to go ___, over there.'", options: ["their", "there", "they're"], answer: "there" },
                    { question: "What is the function of an apostrophe in 'the cat's toy'?", answer: "To show possession" },
                    { question: "Which word completes the simile: 'as brave as a ___'?", answer: "lion" },
                    // Maths Section (28 Qs)
                    { question: "A football pitch measures 115 metres long and 80 metres wide. The area of a rugby pitch is 6,392 square metres. How many square metres smaller is the area of the rugby pitch than the area of the football pitch?", options: ["9200 m²", "2908 m²", "2809 m²", "2808 m²", "6197 m²"], answer: "2808 m²" },
                    { question: "Convert this measurement: 1701 g = ___ kg", options: ["17.01 kg", "1.701 kg", "170.1 kg", "1.7 kg", "0.1701 kg"], answer: "1.701 kg" },
                    { question: "How many lines of symmetry does a rhombus have?", options: ["0", "1", "2", "3", "4"], answer: "2" },
                    { question: "Which is the most appropriate instrument for measuring the distance around a football?", options: ["trundle wheel", "odometer", "metre stick", "tape measure", "ruler"], answer: "tape measure" },
                    { question: "Ahmed cycled 13 km on Monday and 15 km on Thursday. How much further did he cycle on Thursday than on Monday?", options: ["1 km", "3 km", "5 km", "4 km", "2 km"], answer: "2 km" },
                    { question: "What decimal fraction is equivalent to 3/4?", options: ["0.25", "0.33", "0.20", "0.75", "0.10"], answer: "0.75" },
                    { question: "A regular hexagon has a side length of 7 cm. A square has the same perimeter as the hexagon. What is the area of the square?", options: ["42 cm²", "100 cm²", "10.5 cm²", "110.25 cm²", "49 cm²"], answer: "110.25 cm²" },
                    { question: "What is the tenth number in this sequence: 1.5, 3.0, 4.5, 6.0, ...?", options: ["9.0", "12.5", "15", "15.0", "17.5"], answer: "15.0" },
                    { question: "Girls in Years 4, 5, 6, and 7 collected £4, £12, £16, and £17 respectively. What was the average amount collected?", options: ["£12.00", "£12.25", "£12.50", "£10.00", "£13.00"], answer: "£12.25" },
                    { question: "A rectangle's corners are at A(25, 30), B(55, 30), C(55, 14), and D. What are the coordinates of point D?", options: ["(25, 14)", "(55, 30)", "(25, 22)", "(55, 14)", "(40, 14)"], answer: "(25, 14)" },
                    { question: "By how much is 18.401 greater than 14.1?", options: ["4.3", "3.3", "4.301", "3.301", "4"], answer: "4.301" },
                    { question: "A stack of 20 identical pizza boxes is 160 cm tall. Giovanni removes 3 from the top. How tall is the stack now?", options: ["130 cm", "132 cm", "134 cm", "136 cm", "138 cm"], answer: "136 cm" },
                    { question: "What would be the best unit of measure for recording the amount of water in a paddling pool?", options: ["litres", "mm", "cm", "m³", "ml"], answer: "litres" },
                    { question: "A scale shows a weight between 1.2 kg and 1.3 kg, marked in 10 increments. The pointer is on the 4th mark after 1.2. What is the weight?", options: ["1.21 kg", "1.22 kg", "1.23 kg", "1.24 kg", "1.25 kg"], answer: "1.24 kg" },
                    { question: "b × 6 = 48. What does (b + 2) × 5 equal?", options: ["30", "40", "20", "50", "60"], answer: "50" },
                    { question: "How many vertical lines are in an isosceles trapezium with a vertical line of symmetry drawn through it?", options: ["0", "1", "2", "3", "4"], answer: "1" },
                    { question: "What is 7/10 of £17?", options: ["£9.90", "£10.90", "£11.70", "£11.90", "£12.90"], answer: "£11.90" },
                    { question: "A chart showing population change over time with points connected by lines is what type of chart?", options: ["Block Graph", "Pie Chart", "Bar Graph", "Bar-Line Graph", "Line Graph"], answer: "Line Graph" },
                    { question: "A rectangle is divided into 8 equal squares. 6 of them are shaded. What fraction is shaded?", options: ["1/4", "3/8", "5/8", "3/4", "7/8"], answer: "3/4" },
                    { question: "A chart shows temperature ranges. The lowest is -13°C and the highest is 6°C. What is the difference between the highest and lowest temperatures?", options: ["-13°C", "18°C", "19°C", "20°C", "21°C"], answer: "19°C" },
                    { question: "Pattern 1 has 9 blocks. Pattern 2 has 13 blocks. Pattern 3 has 17 blocks. The rule is (Number of blocks) = 4 * PatternNumber + 5. Which pattern will have 49 blocks?", options: ["9", "10", "11", "12", "13"], answer: "11" },
                    { question: "In a sale, everything was reduced by 25%. How much would be saved on an item which usually cost £4.80?", answer: "£1.20" },
                    { question: "A decision tree sorts numbers. If the number is even, it checks if it's a multiple of 5. If not even, it checks if it's a square number. Which box would the number 64 be put into? (Box A: even, mult of 5. Box B: even, not mult of 5. Box C: odd, square. Box D: odd, not square)", answer: "B" },
                    { question: "What is the missing number in this sequence: 2, 5, 11, 23, ___?", answer: "47" },
                    { question: "A film starts at 19:45 and lasts for 1 hour and 35 minutes. What time does it finish?", answer: "21:20" },
                    { question: "Calculate 3.5 × 8.", answer: "28" },
                    { question: "A bag contains 6 red balls and 10 blue balls. What is the probability of picking a red ball?", answer: "6/16" },
                    { question: "What is 15% of 300?", answer: "45" }
                ]
            },
            {
                id: "full-test-2",
                title: "Full Practice Test 2",
                subject: "Mixed",
                questions: [
                    // English Section (28 Qs)
                    { question: "Which sentence is grammatically correct?", options: ["She done her homework.", "She did her homework."], answer: "She did her homework." },
                    { question: "What is the plural of 'goose'?", answer: "geese" },
                    { question: "Identify the adverb: 'The turtle walked slowly.'", answer: "slowly" },
                    { question: "Choose the correct word: 'The book is on ___ shelf.'", options: ["it's", "its"], answer: "its" },
                    { question: "What is an antonym for 'ancient'?", options: ["Old", "Modern", "Historic", "Past"], answer: "Modern" },
                    { question: "Which word is a noun?", options: ["beautiful", "ran", "happiness", "quickly"], answer: "happiness" },
                    { question: "Correct the spelling of 'neccessary'.", answer: "necessary" },
                    { question: "What does the suffix '-less' mean in 'careless'?", answer: "without" },
                    { question: "Identify the verb in the imperative sentence: 'Close the door.'", answer: "Close" },
                    { question: "What is the comparative form of 'bad'?", answer: "worse" },
                    { question: "Which of these is a compound sentence?", options: ["I like tea.", "I like tea and he likes coffee."], answer: "I like tea and he likes coffee." },
                    { question: "What is the collective noun for a group of fish?", answer: "school" },
                    { question: "Choose the correct homophone: 'She has a new ___ of shoes.'", options: ["pair", "pare", "pear"], answer: "pair" },
                    { question: "Identify the type of sentence: 'What a beautiful day!'", answer: "Exclamatory" },
                    { question: "What is the meaning of the idiom 'spill the beans'?", answer: "To reveal a secret" },
                    { question: "Correct the punctuation: 'Lets eat Grandma'", answer: "Let's eat, Grandma." },
                    { question: "What is the abstract noun in: 'Honesty is the best policy.'?", answer: "Honesty" },
                    { question: "Which word is spelled correctly?", options: ["wierd", "weird", "weerd"], answer: "weird" },
                    { question: "Identify the direct object: 'The dog chased the cat.'", answer: "cat" },
                    { question: "What is the opposite of 'expand'?", answer: "contract" },
                    { question: "Which sentence uses 'who' and 'whom' correctly?", options: ["Who did you give the book to?", "Whom did you give the book to?"], answer: "Whom did you give the book to?" },
                    { question: "What is the root word of 'unbelievable'?", answer: "believe" },
                    { question: "Identify the simile: 'He is as strong as an ox.'", answer: "as strong as an ox" },
                    { question: "What is the plural of 'cactus'?", answer: "cacti" },
                    { question: "Choose the correct verb form: 'The news ___ always on at 6.'", options: ["is", "are"], answer: "is" },
                    { question: "What type of pronoun is 'myself'?", answer: "Reflexive" },
                    { question: "Correct the sentence: 'I could of gone to the party.'", answer: "I could have gone to the party." },
                    { question: "What does the prefix 're-' mean in 'rewrite'?", answer: "again" },
                    // Maths Section (28 Qs)
                    { question: "A baker uses 250g of flour for every cake. How many cakes can he bake with a 5kg bag of flour?", options: ["10", "15", "20", "25", "30"], answer: "20" },
                    { question: "What is the value of x if 4x + 5 = 25?", options: ["3", "4", "5", "6", "7"], answer: "5" },
                    { question: "A train travels at 60 mph. How long does it take to travel 150 miles?", options: ["2 hours", "2.5 hours", "3 hours", "3.5 hours", "4 hours"], answer: "2.5 hours" },
                    { question: "What is the next prime number after 19?", options: ["20", "21", "22", "23", "24"], answer: "23" },
                    { question: "A rectangle has a perimeter of 30 cm. Its length is 10 cm. What is its width?", options: ["5 cm", "6 cm", "7 cm", "8 cm", "10 cm"], answer: "5 cm" },
                    { question: "Simplify the ratio 18:24.", options: ["2:3", "3:4", "4:5", "5:6", "6:7"], answer: "3:4" },
                    { question: "What is 0.25 as a percentage?", options: ["2.5%", "25%", "250%", "0.025%", "0.25%"], answer: "25%" },
                    { question: "A circle has a radius of 5 cm. What is its diameter?", options: ["5 cm", "10 cm", "15 cm", "20 cm", "25 cm"], answer: "10 cm" },
                    { question: "Find the mean of these numbers: 4, 6, 8, 10.", options: ["5", "6", "7", "8", "9"], answer: "7" },
                    { question: "If a = 3 and b = 4, what is the value of 2a + 3b?", options: ["15", "16", "17", "18", "19"], answer: "18" },
                    { question: "How many degrees are in a right angle?", options: ["45", "90", "180", "270", "360"], answer: "90" },
                    { question: "What is the square root of 144?", options: ["10", "11", "12", "13", "14"], answer: "12" },
                    { question: "A map has a scale of 1:10000. A distance on the map is 5 cm. What is the real distance in metres?", options: ["50m", "500m", "5000m", "50000m", "5m"], answer: "500m" },
                    { question: "What is the area of a triangle with a base of 10 cm and a height of 6 cm?", options: ["20 cm²", "30 cm²", "40 cm²", "50 cm²", "60 cm²"], answer: "30 cm²" },
                    { question: "Convert 2.5 hours into minutes.", options: ["120", "130", "140", "150", "160"], answer: "150" },
                    { question: "What is the mode of this set of numbers: 2, 3, 3, 4, 5, 5, 5, 6?", options: ["2", "3", "4", "5", "6"], answer: "5" },
                    { question: "A cube has a volume of 27 cm³. What is the length of one side?", options: ["2 cm", "3 cm", "4 cm", "5 cm", "6 cm"], answer: "3 cm" },
                    { question: "What is 3/5 as a decimal?", options: ["0.3", "0.4", "0.5", "0.6", "0.7"], answer: "0.6" },
                    { question: "A car journey starts at 08:30 and ends at 11:15. How long was the journey?", options: ["2h 15m", "2h 30m", "2h 45m", "3h 00m", "3h 15m"], answer: "2h 45m" },
                    { question: "Increase £50 by 20%.", options: ["£52", "£55", "£58", "£60", "£62"], answer: "£60" },
                    { question: "What is the sum of the angles in a quadrilateral?", options: ["90°", "180°", "270°", "360°", "540°"], answer: "360°" },
                    { question: "Write 0.05 as a fraction in its simplest form.", answer: "1/20" },
                    { question: "A book costs £8.50. There is a 10% discount. What is the new price?", answer: "£7.65" },
                    { question: "How many faces does a triangular prism have?", answer: "5" },
                    { question: "What is the next number in the Fibonacci sequence: 1, 1, 2, 3, 5, 8, ___?", answer: "13" },
                    { question: "Calculate 1/4 + 3/8.", answer: "5/8" },
                    { question: "A square has an area of 64 cm². What is its perimeter?", answer: "32 cm" },
                    { question: "What is the largest factor of 24 (other than 24)?", answer: "12" }
                ]
            },
        ];

        // --- Helper Components ---
        const LoadingSpinner = ({ message }) => (
            <div className="flex flex-col justify-center items-center h-screen bg-slate-900">
                <div className="animate-spin rounded-full h-32 w-32 border-t-4 border-b-4 border-cyan-400 mb-4"></div>
                <p className="text-lg text-cyan-400 font-orbitron">{message}</p>
            </div>
        );
        
        const CharacterMessage = ({ message, character }) => {
            const characters = { GameMaster: "🎮" };
            return (
                <div className="bg-slate-800 border-l-4 border-cyan-400 text-cyan-100 p-4 my-6 rounded-r-lg shadow-lg flex items-center">
                    <span className="text-4xl mr-4">{characters[character] || '🤖'}</span>
                    <p className="font-semibold">{message}</p>
                </div>
            );
        };

        // --- Main App Components ---
        const Dashboard = ({ userData, setView, setSelectedTest, allTests }) => {
            const handleSelectTest = (testId, settings) => {
                setSelectedTest({ id: testId, settings });
                setView('quiz');
            };
            if (!userData) return <LoadingSpinner message="Loading user data..." />;
            
            const achievementsList = [
                { id: 'firstTest', title: 'First Mission', description: 'Complete your first test.'},
                { id: 'perfectScore', title: 'Flawless Victory', description: 'Get a 100% score on any test.'},
                { id: 'streak5', title: 'On a Roll', description: 'Answer 5 questions correctly in a row.'},
            ];

            return (
                <div className="p-4 sm:p-8 min-h-screen">
                    <div className="max-w-7xl mx-auto">
                        <div className="flex flex-wrap justify-between items-center mb-8 gap-4">
                            <h1 className="text-3xl sm:text-4xl font-bold font-orbitron glowing-text text-cyan-300">Welcome, {userData.name}!</h1>
                            <div>
                                <button onClick={() => setView('admin')} className="bg-slate-700 text-cyan-300 font-semibold py-2 px-4 rounded-lg hover:bg-slate-600 transition-colors">Admin Panel</button>
                            </div>
                        </div>
                        <CharacterMessage message="Ready to ace these tests? Let's get started!" character="GameMaster" />
                        
                        <div className="mb-8">
                            <h2 className="text-2xl font-orbitron text-cyan-300 mb-4">Achievements</h2>
                            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                                {achievementsList.map(ach => {
                                    const isUnlocked = userData.achievements && userData.achievements[ach.id];
                                    return (
                                        <div key={ach.id} className={`p-4 rounded-lg border-2 ${isUnlocked ? 'border-yellow-400 bg-slate-800' : 'border-slate-700 bg-slate-800/50'}`}>
                                            <div className={`text-4xl mb-2 ${isUnlocked ? 'text-yellow-400' : 'text-slate-600'}`}>🏆</div>
                                            <h3 className={`font-bold ${isUnlocked ? 'text-yellow-300' : 'text-slate-400'}`}>{ach.title}</h3>
                                            <p className="text-sm text-slate-500">{isUnlocked ? ach.description : 'Locked'}</p>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        <div className="bg-slate-800/50 border border-slate-700 rounded-xl shadow-lg p-6">
                            <h2 className="text-2xl font-bold font-orbitron text-cyan-300 mb-6">Available Tests</h2>
                            {allTests.length > 0 ? (
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {allTests.map(test => (
                                        <TestCard key={test.id} testId={test.id} test={test} onStart={handleSelectTest} progress={userData.progress?.[test.id]} />
                                    ))}
                                </div>
                            ) : (
                                <p className="text-slate-400">No tests found. Create one in the Admin Panel.</p>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const TestCard = ({ testId, test, onStart, progress }) => {
            const [feedbackOn, setFeedbackOn] = useState(true);
            const questionsCount = test.questions.length;
            const answeredCount = progress ? Object.keys(progress.answers || {}).length : 0;
            const progressPercent = questionsCount > 0 ? (answeredCount / questionsCount) * 100 : 0;
            const handleStartClick = () => onStart(testId, { feedbackOn });
            return (
                <div className="bg-slate-800 border border-slate-700 rounded-lg p-5 flex flex-col justify-between hover:border-cyan-400 hover:shadow-cyan-500/10 hover:shadow-lg transition-all">
                    <div>
                        <h3 className="text-xl font-bold font-orbitron text-cyan-300">{test.title}</h3>
                        <p className="text-slate-400 mb-4">{test.subject} - {questionsCount} Questions</p>
                        <div className="w-full bg-slate-700 rounded-full h-2.5 mb-2">
                            <div className="bg-cyan-400 h-2.5 rounded-full" style={{ width: `${progressPercent}%` }}></div>
                        </div>
                        <p className="text-sm text-slate-400 mb-4">{answeredCount} / {questionsCount} answered</p>
                    </div>
                    <div>
                        <div className="flex items-center justify-between mb-4">
                            <label className="text-sm font-medium text-slate-300">Live Feedback</label>
                            <div onClick={() => setFeedbackOn(!feedbackOn)} className={`w-12 h-6 flex items-center rounded-full p-1 cursor-pointer transition-colors ${feedbackOn ? 'bg-green-500' : 'bg-slate-600'}`}>
                                <div className={`bg-white w-4 h-4 rounded-full shadow-md transform transition-transform ${feedbackOn ? 'translate-x-6' : ''}`}></div>
                            </div>
                        </div>
                        <button onClick={handleStartClick} className="w-full bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-500 transition-colors">
                            {answeredCount > 0 && answeredCount < questionsCount ? 'Continue Test' : 'Start Test'}
                        </button>
                    </div>
                </div>
            );
        };
        
        const QuizView = ({ userData, testDetails, setView, allTests, updateUserData }) => {
            const { id: testId, settings } = testDetails;
            const test = allTests.find(t => t.id === testId);

            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(userData?.progress?.[testId]?.lastQuestionIndex || 0);
            const [userAnswers, setUserAnswers] = useState(userData?.progress?.[testId]?.answers || {});
            const [streak, setStreak] = useState(userData?.progress?.[testId]?.streak || 0);
            const [hint, setHint] = useState(null);
            const [isHintLoading, setIsHintLoading] = useState(false);

            const getInitialTime = () => {
                const savedTime = userData?.progress?.[testId]?.timeLeft;
                const totalTime = test.subject === 'Mixed' ? 60 * 60 : 30 * 60;
                return (savedTime !== undefined && savedTime > 0) ? savedTime : totalTime;
            };
            const [timeLeft, setTimeLeft] = useState(getInitialTime);
            const [isPaused, setIsPaused] = useState(false);
            const [feedback, setFeedback] = useState(null);

            useEffect(() => {
                if (isPaused || !timeLeft) return;
                const intervalId = setInterval(() => setTimeLeft(t => t > 0 ? t - 1 : 0), 1000);
                return () => clearInterval(intervalId);
            }, [timeLeft, isPaused]);
            
            const calculateScore = useCallback(() => Object.entries(userAnswers).reduce((acc, [index, answer]) => (test.questions[index]?.answer === answer ? acc + 1 : acc), 0), [userAnswers, test.questions]);

            const saveProgress = useCallback((isFinished = false) => {
                const score = calculateScore();
                const newProgress = { ...userData.progress, [testId]: { answers: userAnswers, lastQuestionIndex: currentQuestionIndex, score: score, timeLeft: timeLeft, streak: streak } };
                
                let newAchievements = { ...userData.achievements };
                if (isFinished) {
                    newAchievements.firstTest = true;
                    if (score === test.questions.length) {
                        newAchievements.perfectScore = true;
                    }
                }
                if (streak >= 5) {
                    newAchievements.streak5 = true;
                }

                updateUserData({ ...userData, progress: newProgress, achievements: newAchievements });
            }, [userData, testId, userAnswers, currentQuestionIndex, calculateScore, timeLeft, streak, updateUserData]);

            const handleAnswer = (answer) => {
                const newAnswers = { ...userAnswers, [currentQuestionIndex]: answer };
                setUserAnswers(newAnswers);

                const isCorrect = test.questions[currentQuestionIndex].answer === answer;
                const newStreak = isCorrect ? streak + 1 : 0;
                setStreak(newStreak);

                if (settings.feedbackOn) {
                    setFeedback(isCorrect ? "Correct! Great job!" : `Not quite. The correct answer is: ${test.questions[currentQuestionIndex].answer}`);
                }
            };

            const goToNext = () => {
                if (currentQuestionIndex < test.questions.length - 1) {
                    setFeedback(null);
                    setHint(null);
                    setCurrentQuestionIndex(i => i + 1);
                }
            };

            const handleFinish = () => { saveProgress(true); setView('results'); };
            const handlePause = () => { setIsPaused(true); saveProgress(); alert("Progress saved!"); setView('dashboard'); };

            const fetchHint = async () => {
                setIsHintLoading(true);
                setHint(null);
                const question = test.questions[currentQuestionIndex];
                const prompt = `You are a helpful teaching assistant for a 10-year-old student. Provide a short, simple hint for the following question. Do NOT give the answer. Just provide a small clue to help the student think about the problem correctly. Question: "${question.question}"`;
                
                try {
                    let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                    const payload = { contents: chatHistory };
                    const apiKey = "";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    const text = result.candidates[0].content.parts[0].text;
                    setHint(text);
                } catch (error) {
                    console.error("Error fetching hint:", error);
                    setHint("Sorry, could not get a hint at this time.");
                } finally {
                    setIsHintLoading(false);
                }
            };

            if (!test) return <LoadingSpinner message="Loading Test..." />;
            const currentQ = test.questions[currentQuestionIndex];
            
            useEffect(() => {
                saveProgress();
            }, [userAnswers, currentQuestionIndex]);
            
            return (
                <div className="p-4 sm:p-8 min-h-screen flex items-center justify-center">
                    <div className="bg-slate-800 border border-slate-700 rounded-xl shadow-2xl p-6 sm:p-8 w-full max-w-4xl">
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="text-xl sm:text-2xl font-bold font-orbitron text-cyan-300">{test.title}</h2>
                            <div className="text-lg sm:text-xl font-mono bg-slate-900 text-cyan-300 px-4 py-2 rounded-lg glowing-border">{Math.floor(timeLeft / 60)}:{('0' + timeLeft % 60).slice(-2)}</div>
                        </div>
                        <div className="mb-6 min-h-[6rem]"><p className="text-lg text-gray-300">{currentQ.question}</p></div>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            {currentQ.options ? currentQ.options.map((option, index) => (
                                <button key={index} onClick={() => handleAnswer(option)} disabled={feedback !== null} className={`p-4 rounded-lg border-2 text-left transition-all ${userAnswers[currentQuestionIndex] === option ? 'bg-cyan-900 border-cyan-400' : 'bg-slate-700 border-slate-600 hover:bg-slate-600'} ${feedback !== null ? 'cursor-not-allowed opacity-70' : ''}`}>{option}</button>
                            )) : <textarea value={userAnswers[currentQuestionIndex] || ''} onChange={(e) => handleAnswer(e.target.value)} className="w-full col-span-2 p-4 bg-slate-700 border-2 border-slate-600 rounded-lg" placeholder="Type your answer here..." rows="4"></textarea>}
                        </div>

                        <div className="my-4 text-center">
                            <button onClick={fetchHint} disabled={isHintLoading || hint} className="text-sm text-cyan-400 hover:text-cyan-200 disabled:opacity-50 disabled:cursor-not-allowed">
                                {isHintLoading ? '✨ Generating Hint...' : (hint ? 'Hint Revealed!' : '✨ Get a Hint')}
                            </button>
                            {hint && <div className="mt-2 p-3 bg-slate-700 border border-slate-600 text-yellow-300 rounded-lg text-sm">{hint}</div>}
                        </div>

                        {feedback && <div className={`p-4 rounded-lg my-4 text-white ${feedback.startsWith('Correct') ? 'bg-green-500' : 'bg-red-500'}`}>{feedback}</div>}
                        <div className="flex justify-between mt-8">
                            <button onClick={handlePause} className="bg-yellow-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-yellow-500">Pause & Save</button>
                            {currentQuestionIndex < test.questions.length - 1 ? (
                                <button onClick={goToNext} disabled={settings.feedbackOn && !feedback} className="bg-cyan-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-500 disabled:bg-slate-600">Next</button>
                            ) : (
                                <button onClick={handleFinish} className="bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-500">Finish Test</button>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const ResultsView = ({ userData, setView }) => (
            <div className="p-8 min-h-screen flex items-center justify-center">
                <div className="bg-slate-800 border border-slate-700 rounded-xl shadow-2xl p-8 w-full max-w-3xl text-center">
                    <h2 className="text-4xl font-bold text-cyan-300 font-orbitron mb-4">Test Complete!</h2>
                    <p className="text-lg text-gray-300 mb-8">Great work, {userData.name}! Your results have been saved.</p>
                    <CharacterMessage message="Every test you complete makes you stronger. Awesome job!" character="GameMaster" />
                    <button onClick={() => setView('dashboard')} className="bg-cyan-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-cyan-500">Back to Dashboard</button>
                </div>
            </div>
        );

        const AdminView = ({ userData, setView, allTests, updateAllData }) => {
            const [adminView, setAdminView] = useState('main');

            const handleResetProgress = (testId) => {
                if (!window.confirm(`Are you sure you want to reset all progress for this test?`)) return;
                const newProgress = { ...userData.progress };
                delete newProgress[testId];
                updateAllData({ userData: { ...userData, progress: newProgress }, allTests });
                alert("Progress reset successfully!");
            };
            
            if (adminView === 'create') {
                return <CreateTestView setAdminView={setAdminView} allTests={allTests} updateAllData={updateAllData} userData={userData} />;
            }
            
            if (adminView === 'analysis') {
                return <ProblemAnalysisView setAdminView={setAdminView} userData={userData} allTests={allTests} />;
            }

            return (
                <div className="p-8 min-h-screen">
                    <div className="max-w-5xl mx-auto">
                        <div className="flex justify-between items-center mb-8">
                            <h1 className="text-4xl font-bold font-orbitron text-cyan-300">Admin Panel</h1>
                            <button onClick={() => setView('dashboard')} className="bg-slate-700 font-semibold py-2 px-4 rounded-lg hover:bg-slate-600">&larr; Back to Dashboard</button>
                        </div>
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                            <button onClick={() => setAdminView('create')} className="bg-green-600 text-white p-6 rounded-lg font-bold text-xl hover:bg-green-500">Create New Test</button>
                            <button onClick={() => setAdminView('analysis')} className="bg-purple-600 text-white p-6 rounded-lg font-bold text-xl hover:bg-purple-500">Problem Analysis</button>
                        </div>

                        <div className="bg-slate-800/50 border border-slate-700 rounded-xl p-6">
                            <h2 className="text-2xl font-bold mb-4 font-orbitron text-cyan-300">Manage Tests</h2>
                            <div className="space-y-4">
                                {allTests.map(test => (
                                    <div key={test.id} className="bg-slate-800 p-4 rounded-lg flex justify-between items-center">
                                        <div><h3 className="text-lg font-bold">{test.title}</h3><p className="text-slate-400">{test.questions.length} questions</p></div>
                                        <button onClick={() => handleResetProgress(test.id)} className="bg-red-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-700">Reset Progress</button>
                                    </div>
                                ))}
                            </div>
                        </div>
                         <div className="bg-slate-800/50 border border-slate-700 rounded-xl p-6 mt-8">
                            <h2 className="text-xl font-bold mb-4 font-orbitron text-cyan-300">Data Warning</h2>
                            <p className="text-slate-400">All progress and created tests are saved in this browser's local storage. Clearing browser data will erase everything.</p>
                        </div>
                    </div>
                </div>
            );
        };
        
        const CreateTestView = ({ setAdminView, allTests, updateAllData, userData }) => {
            const [title, setTitle] = useState('');
            const [subject, setSubject] = useState('Maths');
            const [questions, setQuestions] = useState([{ question: '', options: ['', '', '', ''], answer: '' }]);

            const handleQuestionChange = (index, field, value) => {
                const newQuestions = [...questions];
                newQuestions[index][field] = value;
                setQuestions(newQuestions);
            };
            
            const handleOptionChange = (qIndex, oIndex, value) => {
                const newQuestions = [...questions];
                newQuestions[qIndex].options[oIndex] = value;
                setQuestions(newQuestions);
            };

            const addQuestion = () => {
                setQuestions([...questions, { question: '', options: ['', '', '', ''], answer: '' }]);
            };
            
            const handleSaveTest = () => {
                if (!title || questions.some(q => !q.question || !q.answer)) {
                    alert("Please fill out the title and ensure every question has a question text and a correct answer.");
                    return;
                }
                const newTest = { id: `custom-${Date.now()}`, title, subject, questions };
                const newAllTests = [...allTests, newTest];
                updateAllData({ userData, allTests: newAllTests });
                alert("Test saved successfully!");
                setAdminView('main');
            };

            return (
                 <div className="p-8 min-h-screen">
                    <div className="max-w-4xl mx-auto">
                        <div className="flex justify-between items-center mb-8">
                            <h1 className="text-3xl font-bold font-orbitron text-cyan-300">Create New Test</h1>
                            <button onClick={() => setAdminView('main')} className="bg-slate-700 font-semibold py-2 px-4 rounded-lg hover:bg-slate-600">&larr; Back to Admin</button>
                        </div>
                        <div className="bg-slate-800/50 border border-slate-700 p-6 rounded-xl space-y-6">
                            <div>
                                <label className="block mb-2 font-bold">Test Title</label>
                                <input type="text" value={title} onChange={e => setTitle(e.target.value)} className="w-full p-2 bg-slate-700 rounded-md border border-slate-600" />
                            </div>
                            <div>
                                <label className="block mb-2 font-bold">Subject</label>
                                <select value={subject} onChange={e => setSubject(e.target.value)} className="w-full p-2 bg-slate-700 rounded-md border border-slate-600">
                                    <option>Maths</option>
                                    <option>English</option>
                                    <option>Mixed</option>
                                </select>
                            </div>
                            <hr className="border-slate-600"/>
                            {questions.map((q, qIndex) => (
                                <div key={qIndex} className="bg-slate-800 p-4 rounded-lg border border-slate-700">
                                    <label className="block mb-2 font-bold">Question {qIndex + 1}</label>
                                    <textarea value={q.question} onChange={e => handleQuestionChange(qIndex, 'question', e.target.value)} className="w-full p-2 bg-slate-700 rounded-md border border-slate-600" rows="2" placeholder="Enter question text..."></textarea>
                                    <div className="grid grid-cols-2 gap-4 my-4">
                                        {q.options.map((opt, oIndex) => (
                                             <input key={oIndex} type="text" value={opt} onChange={e => handleOptionChange(qIndex, oIndex, e.target.value)} placeholder={`Option ${oIndex + 1}`} className="p-2 bg-slate-700 rounded-md border border-slate-600" />
                                        ))}
                                    </div>
                                    <label className="block mb-2 font-bold">Correct Answer</label>
                                    <input type="text" value={q.answer} onChange={e => handleQuestionChange(qIndex, 'answer', e.target.value)} placeholder="Must match one of the options exactly" className="w-full p-2 bg-slate-700 rounded-md border border-slate-600" />
                                </div>
                            ))}
                            <button onClick={addQuestion} className="bg-slate-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-slate-500">Add Another Question</button>
                        </div>
                        <div className="mt-8 text-center">
                            <button onClick={handleSaveTest} className="bg-green-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-500 text-xl">Save Test</button>
                        </div>
                    </div>
                </div>
            );
        };
        
        const ProblemAnalysisView = ({ setAdminView, userData, allTests }) => {
            const [analysis, setAnalysis] = useState(null);
            const [explanations, setExplanations] = useState({});
            const [isLoadingExplanation, setIsLoadingExplanation] = useState(null);

            useEffect(() => {
                const incorrectAnswers = [];
                if (userData.progress && allTests.length > 0) {
                    Object.entries(userData.progress).forEach(([testId, progressData]) => {
                        const test = allTests.find(t => t.id === testId);
                        if (test) {
                            Object.entries(progressData.answers).forEach(([qIndex, userAnswer]) => {
                                const question = test.questions[qIndex];
                                if (question && question.answer !== userAnswer) {
                                    incorrectAnswers.push({
                                        questionText: question.question,
                                        correctAnswer: question.answer,
                                        userAnswer: userAnswer,
                                    });
                                }
                            });
                        }
                    });
                }
                
                const counts = incorrectAnswers.reduce((acc, curr) => {
                    if (!acc[curr.questionText]) {
                        acc[curr.questionText] = { count: 0, details: curr };
                    }
                    acc[curr.questionText].count += 1;
                    return acc;
                }, {});

                const sortedAnalysis = Object.entries(counts)
                    .map(([question, data]) => ({ question, count: data.count, details: data.details }))
                    .sort((a, b) => b.count - a.count);
                
                setAnalysis(sortedAnalysis);
            }, [userData, allTests]);

            const fetchExplanation = async (item, index) => {
                setIsLoadingExplanation(index);
                const prompt = `You are a friendly and encouraging teacher helping a 10-11 year old student study. Explain the answer to the following question in a simple, step-by-step way. Question: "${item.details.questionText}" The correct answer is: "${item.details.correctAnswer}" The student's incorrect answer was: "${item.details.userAnswer}". Explain how to get the correct answer.`;
                
                try {
                    let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                    const payload = { contents: chatHistory };
                    const apiKey = "";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    const text = result.candidates[0].content.parts[0].text;
                    setExplanations(prev => ({ ...prev, [index]: text }));
                } catch (error) {
                    console.error("Error fetching explanation:", error);
                    setExplanations(prev => ({ ...prev, [index]: "Sorry, could not get an explanation at this time." }));
                } finally {
                    setIsLoadingExplanation(null);
                }
            };

            return (
                <div className="p-8 min-h-screen">
                    <div className="max-w-4xl mx-auto">
                        <div className="flex justify-between items-center mb-8">
                            <h1 className="text-3xl font-bold font-orbitron text-cyan-300">Problem Analysis</h1>
                            <button onClick={() => setAdminView('main')} className="bg-slate-700 font-semibold py-2 px-4 rounded-lg hover:bg-slate-600">&larr; Back to Admin</button>
                        </div>
                        <div className="bg-slate-800/50 border border-slate-700 p-6 rounded-xl">
                            <h2 className="text-xl font-bold mb-4">Most Frequently Incorrect Questions</h2>
                            {analysis && analysis.length > 0 ? (
                                <ul className="space-y-4">
                                    {analysis.map((item, index) => (
                                        <li key={index} className="bg-slate-800 p-4 rounded-lg">
                                            <p className="font-semibold text-gray-300">"{item.question}"</p>
                                            <p className="text-red-400 font-bold">Incorrect {item.count} time(s)</p>
                                            <button onClick={() => fetchExplanation(item, index)} disabled={isLoadingExplanation === index} className="mt-2 text-sm text-cyan-400 hover:text-cyan-200 disabled:opacity-50">
                                                {isLoadingExplanation === index ? '✨ Generating...' : '✨ Get AI Explanation'}
                                            </button>
                                            {explanations[index] && <div className="mt-2 p-3 bg-slate-700 border border-slate-600 text-yellow-300 rounded-lg text-sm whitespace-pre-wrap">{explanations[index]}</div>}
                                        </li>
                                    ))}
                                </ul>
                            ) : (
                                <p className="text-slate-400">No incorrect answers have been recorded yet. Complete some tests to see analysis.</p>
                            )}
                        </div>
                    </div>
                </div>
            );
        };


        // --- Main App Component ---
        function App() {
            const [appData, setAppData] = useState(null);
            const [view, setView] = useState('loading');
            const [selectedTest, setSelectedTest] = useState(null);

            // Load data from localStorage on initial render
            useEffect(() => {
                const savedData = localStorage.getItem('seagPortalData');
                if (savedData) {
                    setAppData(JSON.parse(savedData));
                } else {
                    // Initialize with default data if nothing is saved
                    setAppData({
                        userData: { name: "Nicolas", progress: {}, achievements: {} },
                        allTests: defaultTests
                    });
                }
                setView('dashboard');
            }, []);

            // Save data to localStorage whenever it changes
            const updateAllData = useCallback((newData) => {
                setAppData(newData);
                localStorage.setItem('seagPortalData', JSON.stringify(newData));
            }, []);
            
            const updateUserData = useCallback((newUserData) => {
                if(appData){
                    updateAllData({ ...appData, userData: newUserData });
                }
            }, [appData, updateAllData]);


            if (!appData) {
                return <LoadingSpinner message="Initializing System..." />;
            }

            const renderView = () => {
                switch (view) {
                    case 'loading': return <LoadingSpinner message="Loading Portal..." />;
                    case 'dashboard': return <Dashboard userData={appData.userData} setView={setView} setSelectedTest={setSelectedTest} allTests={appData.allTests} />;
                    case 'quiz': return <QuizView userData={appData.userData} testDetails={selectedTest} setView={setView} allTests={appData.allTests} updateUserData={updateUserData} />;
                    case 'results': return <ResultsView userData={appData.userData} setView={setView} />;
                    case 'admin': return <AdminView userData={appData.userData} setView={setView} allTests={appData.allTests} updateAllData={updateAllData} />;
                    default: return <LoadingSpinner message="Loading Portal..." />;
                }
            };

            return <div className="font-sans">{renderView()}</div>;
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
